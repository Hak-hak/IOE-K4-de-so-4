<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOE K4 ĐỀ SỐ 04</title>
    <!-- Libraries from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
      body { font-family: 'Nunito', sans-serif; }
      
      /* Custom Scrollbar */
      .custom-scrollbar::-webkit-scrollbar { width: 8px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      
      /* Simple Animations */
      @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
      .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
      
      @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
      .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }

      @keyframes bounceShort { 
        0%, 100% { transform: translateY(0); } 
        50% { transform: translateY(-5px); } 
      }
      .animate-bounce-short { animation: bounceShort 1s infinite; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>
<body class="bg-slate-100 text-slate-800 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. TYPES & ENUMS ---
        const QuestionType = {
            MULTIPLE_CHOICE: 'MULTIPLE_CHOICE',
            FILL_IN_BLANK: 'FILL_IN_BLANK',
            REARRANGE: 'REARRANGE'
        };

        const GameState = {
            START: 'START',
            PLAYING: 'PLAYING',
            FINISHED: 'FINISHED'
        };

        // --- 2. CONSTANTS & DATA ---
        const cleanUrl = (url) => {
            if (!url) return undefined;
            return url.trim()
                .replace(/\s+/g, '') // Remove spaces
                .replace(/res\.ioe\.vnzedu/, 'res.ioe.vn/edu') // Fix domain typos
                .replace(/res\.ioe\.vii/, 'res.ioe.vn')
                .replace(/res\.ioe\.vm/, 'res.ioe.vn')
                .replace(/Audio\s*mp3/i, 'Audio.mp3') // Fix extension
                .replace(/ImageExam\s*(\d)/, 'ImageExam/$1') // Fix path separators
                .replace(/Olympic\s*ExamData/, 'OlympicExamData')
                .replace(/EOlympic\s*ExamData/, 'EOlympic/ExamData')
                .replace(/'/g, '') // Remove accidental quotes
                .replace(/Audio-mp3/i, 'Audio.mp3');
        };

        const QUIZ_DATA = [
  { id: 1, type: QuestionType.MULTIPLE_CHOICE, questionText: "Does she go to school on Monday? - Yes, she ... .", options: ["doesn’t", "isn’t", "is", "does"], correctAnswer: "does", explanation: "Yes, she does." },
  { id: 2, type: QuestionType.MULTIPLE_CHOICE, questionText: "In ... class, we learn how to use computers.", options: ["IT", "Arts", "Literature", "Maths"], correctAnswer: "IT", explanation: "IT (Information Technology): Tin học." },
  { id: 3, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["What", "that", "book?", "colour", "is"], correctAnswer: "What colour is that book?", explanation: "Quyển sách đó màu gì?" },
  { id: 4, type: QuestionType.MULTIPLE_CHOICE, questionText: "August is the eighth month ... the year.", options: ["by", "on", "of", "from"], correctAnswer: "of", explanation: "Month of the year: Tháng trong năm." },
  { id: 5, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ ose are my pencils.", correctAnswer: "Th", explanation: "Those: Những cái kia." },
  { id: 6, type: QuestionType.MULTIPLE_CHOICE, questionText: "Our village is small but _______.", options: ["large", "beautiful", "big", "tiny"], correctAnswer: "beautiful", explanation: "Small but beautiful: Nhỏ nhưng đẹp (tương phản)." },
  { id: 7, type: QuestionType.FILL_IN_BLANK, questionText: "This banana is _ _ _ you, Mai.", correctAnswer: "for", explanation: "For you: Cho bạn." },
  { id: 8, type: QuestionType.MULTIPLE_CHOICE, questionText: "How old is Paul? - ...’s 8 years old.", options: ["He is", "He’s", "She", "He"], correctAnswer: "He", explanation: "Paul (nam) -> He." },
  { id: 9, type: QuestionType.MULTIPLE_CHOICE, questionText: "I learn … numbers during Maths lessons.", options: ["to", "about", "at", "on"], correctAnswer: "about", explanation: "Learn about: Học về." },
  { id: 10, type: QuestionType.MULTIPLE_CHOICE, questionText: "When is ... birthday?", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206405954321122_Audio.mp3"), options: ["you", "their", "your", "our"], correctAnswer: "your", explanation: "Your birthday: Sinh nhật bạn." },
  { id: 11, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["do you", "time", "to bed?", "go", "What"], correctAnswer: "What time do you go to bed?", explanation: "Bạn đi ngủ lúc mấy giờ?" },
  { id: 12, type: QuestionType.FILL_IN_BLANK, questionText: "What ab_ _ t an apple? – Yes, please.", correctAnswer: "ou", explanation: "What about: Thế còn... (lời gợi ý)." },
  { id: 13, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["What", "like?", "do", "you", "subject"], correctAnswer: "What subject do you like?", explanation: "Bạn thích môn học nào?" },
  { id: 14, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["your", "subject?", "is", "favourite", "What"], correctAnswer: "What is your favourite subject?", explanation: "Môn học yêu thích của bạn là gì?" },
  { id: 15, type: QuestionType.FILL_IN_BLANK, questionText: "What do you do _ _ Sunday?", correctAnswer: "on", explanation: "On Sunday: Vào Chủ Nhật." },
  { id: 16, type: QuestionType.FILL_IN_BLANK, questionText: "Where is he f_ _ m? – He is from England.", correctAnswer: "ro", explanation: "From: Đến từ." },
  { id: 17, type: QuestionType.MULTIPLE_CHOICE, questionText: "Mr. Winsor is from … . He’s English.", options: ["England", "Singapore", "Australia", "China"], correctAnswer: "England", explanation: "English (người Anh) -> England (nước Anh)." },
  { id: 18, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["What", "bag?", "is", "in", "this"], correctAnswer: "What is in this bag?", explanation: "Có cái gì trong cái túi này?" },
  { id: 19, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["kitchen", "There is", "one", "her house.", "in"], correctAnswer: "There is one kitchen in her house.", explanation: "Có một cái bếp trong nhà cô ấy." },
  { id: 20, type: QuestionType.MULTIPLE_CHOICE, questionText: "… old is your sister? – She is nine years old.", options: ["When", "What", "Where", "How"], correctAnswer: "How", explanation: "How old: Bao nhiêu tuổi." },
  { id: 21, type: QuestionType.FILL_IN_BLANK, questionText: "I h_ ve a new pen.", correctAnswer: "a", explanation: "Have: Có." },
  { id: 22, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["is", "Jeremy", "hair.", "the boy", "with short"], correctAnswer: "Jeremy is the boy with short hair.", explanation: "Jeremy là cậu bé có mái tóc ngắn." },
  { id: 23, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ _ _ _", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2019/11/28/637105366552691962_Audio.mp3"), correctAnswer: "Friday", explanation: "Nghe audio: thứ 6." },
  { id: 24, type: QuestionType.FILL_IN_BLANK, questionText: "What’s the matter with you? - I’m b_ _ _ _ .", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207252771027496_566X320.jpg"), correctAnswer: "ored", explanation: "Bored: Chán nản." },
  { id: 25, type: QuestionType.FILL_IN_BLANK, questionText: "A: What’s your _ _ _ _ y? - B: I like taking photos.", correctAnswer: "hobb", explanation: "Hobby: Sở thích." },
  { id: 26, type: QuestionType.MULTIPLE_CHOICE, questionText: "What is your mother doing? – She is ___ in the kitchen.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/D2_29.jpg"), options: ["doing", "cooking", "painting", "reading"], correctAnswer: "cooking", explanation: "Cooking: Nấu ăn." },
  { id: 27, type: QuestionType.FILL_IN_BLANK, questionText: "What subject do you like the m_ _ t?", correctAnswer: "os", explanation: "The most: Nhất." },
  { id: 28, type: QuestionType.MULTIPLE_CHOICE, questionText: "How often do you visit your grandmother? – I visit my grandmother ___.", options: ["one a month", "twice a month", "two time a month", "three time a month"], correctAnswer: "twice a month", explanation: "Twice a month: Hai lần một tháng." },
  { id: 29, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Good morning,", "class. What", "it today?", "day is"], correctAnswer: "Good morning, class. What day is it today?", explanation: "Chào cả lớp. Hôm nay là thứ mấy?" },
  { id: 30, type: QuestionType.MULTIPLE_CHOICE, questionText: "The picture ______ above the table in the bedroom.", options: ["on", "are", "is", "up"], correctAnswer: "is", explanation: "The picture (số ít) -> is." },
  { id: 31, type: QuestionType.FILL_IN_BLANK, questionText: "What do you like doing, Phong? – I like w_ _ ching TV.", correctAnswer: "at", explanation: "Watching TV: Xem TV." },
  { id: 32, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["down", "the", "words.", "Copy"], correctAnswer: "Copy down the words.", explanation: "Chép lại các từ." },
  { id: 33, type: QuestionType.FILL_IN_BLANK, questionText: "Linh always makes a wish on _ _ _ birthday.", correctAnswer: "her", explanation: "Her birthday: Sinh nhật cô ấy." },
  { id: 34, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["the", "Tomorrow is", "of", "November.", "ninth"], correctAnswer: "Tomorrow is the ninth of November.", explanation: "Ngày mai là mùng 9 tháng 11." },
  { id: 35, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["doesn’t know", "She", "how to", "her name.", "spell"], correctAnswer: "She doesn’t know how to spell her name.", explanation: "Cô ấy không biết đánh vần tên mình." },
  { id: 36, type: QuestionType.FILL_IN_BLANK, questionText: "Wh_ does she like Arts?", correctAnswer: "y", explanation: "Why: Tại sao." },
  { id: 37, type: QuestionType.FILL_IN_BLANK, questionText: "Does Ngoc h_ _ _ Maths today?", correctAnswer: "ave", explanation: "Have: Có." },
  { id: 38, type: QuestionType.FILL_IN_BLANK, questionText: "Would you like som_ milk?", correctAnswer: "e", explanation: "Some: Một ít." },
  { id: 39, type: QuestionType.FILL_IN_BLANK, questionText: "It’s seven o’clock. She’s _ _ _ _ ing.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505777001185318_Audio.mp3"), correctAnswer: "read", explanation: "Reading: Đang đọc (Dự đoán)." },
  { id: 40, type: QuestionType.MULTIPLE_CHOICE, questionText: "… the weather in Hanoi today?", options: ["What’s", "Who’s", "How’s", "When’s"], correctAnswer: "How’s", explanation: "How's the weather: Thời tiết thế nào." },
  { id: 41, type: QuestionType.MULTIPLE_CHOICE, questionText: "Phuong can ___ a bike to the school.", options: ["go", "take", "ride", "skate"], correctAnswer: "ride", explanation: "Ride a bike: Đi xe đạp." },
  { id: 42, type: QuestionType.MULTIPLE_CHOICE, questionText: "What does he do on Thursday?", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/nghe/D4_11.mp3"), options: ["He studies Art on Thursday.", "He studies English on Thursday.", "He studies Maths on Thursday.", "He studies Music on Thursday."], correctAnswer: "He studies Maths on Thursday.", explanation: "Nghe audio." },
  { id: 43, type: QuestionType.MULTIPLE_CHOICE, questionText: "Odd one out.", options: ["Mary", "America", "Vietnam", "England"], correctAnswer: "Mary", explanation: "Mary là tên người, còn lại là tên nước." },
  { id: 44, type: QuestionType.FILL_IN_BLANK, questionText: "There are a lot of flowers and vegetables in our gar_ _ _ .", correctAnswer: "den", explanation: "Garden: Khu vườn." },
  { id: 45, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["much", "is", "How", "book?", "that"], correctAnswer: "How much is that book?", explanation: "Quyển sách đó giá bao nhiêu?" },
  { id: 46, type: QuestionType.MULTIPLE_CHOICE, questionText: "Sorry, I’m ______.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2019/11/28/637105327139009573_Audio.mp3"), options: ["wrong", "late", "false", "not well."], correctAnswer: "late", explanation: "I'm late: Tôi bị muộn." },
  { id: 47, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["from", "I", "America.", "am"], correctAnswer: "I am from America.", explanation: "Tôi đến từ Mỹ." },
  { id: 48, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["girl?", "the", "Where", "is"], correctAnswer: "Where is the girl?", explanation: "Cô gái đó ở đâu?" },
  { id: 49, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["pencil?", "that", "colour", "is", "What"], correctAnswer: "What colour is that pencil?", explanation: "Cái bút chì đó màu gì?" },
  { id: 50, type: QuestionType.MULTIPLE_CHOICE, questionText: "Odd one out:", options: ["chair", "monkey", "rabbit", "fish"], correctAnswer: "chair", explanation: "Chair là đồ vật, còn lại là con vật." },
  { id: 51, type: QuestionType.FILL_IN_BLANK, questionText: "S_ _ P", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/d3_11.jpg"), correctAnswer: "KI", explanation: "Ship: Con tàu." },
  { id: 52, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["the", "please.", "ruler,", "Give", "me"], correctAnswer: "Give me the ruler, please.", explanation: "Làm ơn đưa tôi cái thước kẻ." },
  { id: 53, type: QuestionType.FILL_IN_BLANK, questionText: "There are t_ elve students in her classroom.", correctAnswer: "w", explanation: "Twelve: 12." },
  { id: 54, type: QuestionType.MULTIPLE_CHOICE, questionText: "You can buy some books or some pens at the ....", options: ["bookshop", "cinema", "post office", "zoo"], correctAnswer: "bookshop", explanation: "Bookshop: Hiệu sách." },
  { id: 55, type: QuestionType.FILL_IN_BLANK, questionText: "My sister likes _ _ _ _ _ _ _ the piano.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207259076848620_566X320.jpg"), correctAnswer: "playing", explanation: "Playing the piano: Chơi đàn piano." },
  { id: 56, type: QuestionType.FILL_IN_BLANK, questionText: "I’d l_ _ e an orange, please.", correctAnswer: "ik", explanation: "Like: Muốn." },
  { id: 57, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["What", "like?", "does", "look", "your father"], correctAnswer: "What does your father look like?", explanation: "Bố bạn trông như thế nào?" },
  { id: 58, type: QuestionType.FILL_IN_BLANK, questionText: "I have t_ o robots.", correctAnswer: "w", explanation: "Two: 2." },
  { id: 59, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["My favourite", "subjects", "are Maths", "and Music."], correctAnswer: "My favourite subjects are Maths and Music.", explanation: "Những môn học yêu thích của tôi là Toán và Nhạc." },
  { id: 60, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out.", options: ["volleyball", "basketball", "badminton", "computer"], correctAnswer: "computer", explanation: "Computer là thiết bị, còn lại là thể thao." },
  { id: 61, type: QuestionType.MULTIPLE_CHOICE, questionText: "This is my friend. She’s from ___. ", options: ["Vietnamese", "Japanese", "Malaysian", "Australia"], correctAnswer: "Australia", explanation: "From + Country (Tên nước)." },
  { id: 62, type: QuestionType.FILL_IN_BLANK, questionText: "Uncle Ho’s birthday is on the nineteenth of M_ _ .", correctAnswer: "ay", explanation: "May: Tháng 5." },
  { id: 63, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["I", "like", "Art", "lessons", "best."], correctAnswer: "I like Art lessons best.", explanation: "Tôi thích giờ Mỹ thuật nhất." },
  { id: 64, type: QuestionType.FILL_IN_BLANK, questionText: "The tenth month of the year is _ _ _ _ _ _ _ .", correctAnswer: "October", explanation: "October: Tháng 10." },
  { id: 65, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["is", "Ann. She’s", "That", "English."], correctAnswer: "That is Ann. She’s English.", explanation: "Đó là Ann. Cô ấy là người Anh." },
  { id: 66, type: QuestionType.FILL_IN_BLANK, questionText: "Open the book and r_ _ d after me, please.", correctAnswer: "ea", explanation: "Read: Đọc." },
  { id: 67, type: QuestionType.MULTIPLE_CHOICE, questionText: "___ you Australian, John?", options: ["Am", "Do", "Are", "Is"], correctAnswer: "Are", explanation: "You -> Are." },
  { id: 68, type: QuestionType.FILL_IN_BLANK, questionText: "My sister can _ _ _ e a bicycle.", correctAnswer: "rid", explanation: "Ride: Đi (xe)." },
  { id: 69, type: QuestionType.MULTIPLE_CHOICE, questionText: "I have fifty stamps. My brothers have thirty stamps. How many stamps do we have?", options: ["Seventeen stamps", "Seventy stamps", "Eighty stamps", "Eighteen stamps"], correctAnswer: "Eighty stamps", explanation: "50 + 30 = 80 (Eighty)." },
  { id: 70, type: QuestionType.FILL_IN_BLANK, questionText: "Would you l_ _ _ an ice cream? - No, thanks.", correctAnswer: "ike", explanation: "Like: Muốn." },
  { id: 71, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["book.", "reading", "a", "am", "I"], correctAnswer: "I am reading a book.", explanation: "Tôi đang đọc sách." },
  { id: 72, type: QuestionType.FILL_IN_BLANK, questionText: "I can play table t_ _ _ _ _ .", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi%20Th%E1%BB%AD/Thi_trai_nghiem_2021/Lop4/Anh/anh8.jpg"), correctAnswer: "ennis", explanation: "Table tennis: Bóng bàn." },
  { id: 73, type: QuestionType.MULTIPLE_CHOICE, questionText: "… are you going to do this weekend?", options: ["Where", "When", "What", "Why"], correctAnswer: "What", explanation: "What: Làm gì." },
  { id: 74, type: QuestionType.MULTIPLE_CHOICE, questionText: "Goodbye, Peter. ... .", options: ["Later see you", "See you later", "See later you", "You see later"], correctAnswer: "See you later", explanation: "See you later: Hẹn gặp lại." },
  { id: 75, type: QuestionType.FILL_IN_BLANK, questionText: "Nam can sp_ _ _ English.", correctAnswer: "eak", explanation: "Speak: Nói." },
  { id: 76, type: QuestionType.FILL_IN_BLANK, questionText: "Wear these _ _ _ _ s. It’s very cold and wet.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636162019988815196_566X320.jpg"), correctAnswer: "boot", explanation: "Boots: Đôi ủng." },
  { id: 77, type: QuestionType.FILL_IN_BLANK, questionText: "I have three new _ _ _ _ _ .", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206450576162044_Audio.mp3"), correctAnswer: "books", explanation: "Nghe audio: Sách." },
  { id: 78, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["do you", "Sunday morning?", "What", "do", "on"], correctAnswer: "What do you do on Sunday morning?", explanation: "Bạn làm gì vào sáng Chủ Nhật?" },
  { id: 79, type: QuestionType.FILL_IN_BLANK, questionText: "I can _ _ _ _ _ English very well.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206440071561593_Audio.mp3"), correctAnswer: "speak", explanation: "Speak: Nói." },
  { id: 80, type: QuestionType.FILL_IN_BLANK, questionText: "The _ _ _ _ _ _ th of August is my birthday.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505775177275149_566X320.jpg"), correctAnswer: "eleven", explanation: "Eleventh: Ngày 11." },
  { id: 81, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["cake", "pizza", "cheese", "bottle"], correctAnswer: "bottle", explanation: "Bottle là vật dụng, còn lại là thức ăn." },
  { id: 82, type: QuestionType.FILL_IN_BLANK, questionText: "Pete’s birthday is on the third _ _ September.", correctAnswer: "of", explanation: "The third of September: Ngày 3 tháng 9." },
  { id: 83, type: QuestionType.FILL_IN_BLANK, questionText: "Good _ _ rning!", correctAnswer: "mo", explanation: "Good morning: Chào buổi sáng." },
  { id: 84, type: QuestionType.FILL_IN_BLANK, questionText: "Where are you from, Tom? – I’m from Can_ _ a.", correctAnswer: "ad", explanation: "Canada: Nước Canada." },
  { id: 85, type: QuestionType.FILL_IN_BLANK, questionText: "This is my pen friend. He’s A_ _ _ _ can.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/D2_16.jpg"), correctAnswer: "meri", explanation: "American: Người Mỹ." },
  { id: 86, type: QuestionType.FILL_IN_BLANK, questionText: "- What colour is your plane?- It’s _ _ _ .", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/25/636787720717152429_566X320.jpg"), correctAnswer: "red", explanation: "Red: Màu đỏ." },
  { id: 87, type: QuestionType.FILL_IN_BLANK, questionText: "This is my r_ om.", correctAnswer: "o", explanation: "Room: Phòng." },
  { id: 88, type: QuestionType.MULTIPLE_CHOICE, questionText: "I’d like a cup of ... .", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208411979725470_566X320.jpg"), options: ["tea", "beer", "water", "coffee"], correctAnswer: "coffee", explanation: "Cup of coffee: Tách cà phê." },
  { id: 89, type: QuestionType.FILL_IN_BLANK, questionText: "Wh_ _ _ are the maps? – They are on the wall.", correctAnswer: "ere", explanation: "Where: Ở đâu." },
  { id: 90, type: QuestionType.MULTIPLE_CHOICE, questionText: "Can you dance, Alice? - ..., I can.", options: ["No", "Not", "Yes", "Are"], correctAnswer: "Yes", explanation: "Yes, I can." },
  { id: 91, type: QuestionType.MULTIPLE_CHOICE, questionText: "What subjects does Phong have today?", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790856572586307_Audio.mp3"), options: ["Maths, Science and Music.", "Maths, Science and English.", "Science, Music and English.", "Maths, Music and English."], correctAnswer: "Maths, Music and English.", explanation: "Nghe audio." },
  { id: 92, type: QuestionType.FILL_IN_BLANK, questionText: "I listened to music and watched TV yes_ _ _ day morning.", correctAnswer: "ter", explanation: "Yesterday: Hôm qua." },
  { id: 93, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Peter", "Australia.", "from", "is"], correctAnswer: "Peter is from Australia.", explanation: "Peter đến từ Úc." },
  { id: 94, type: QuestionType.MULTIPLE_CHOICE, questionText: "What ... is your car?", options: ["color", "this", "that", "the"], correctAnswer: "color", explanation: "What color: Màu gì." },
  { id: 95, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["a week.", "have", "twice", "Music", "We"], correctAnswer: "We have Music twice a week.", explanation: "Chúng tôi có môn Nhạc 2 lần một tuần." },
  { id: 96, type: QuestionType.MULTIPLE_CHOICE, questionText: "Listen and tick:", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206446837459478_Audio.mp3"), options: ["I like drawing.", "I like gardening.", "I like dancing.", "I like skating."], correctAnswer: "I like dancing.", explanation: "Nghe audio." },
  { id: 97, type: QuestionType.FILL_IN_BLANK, questionText: "This is my brother. _ _ s name is David.", correctAnswer: "Hi", explanation: "His name: Tên cậu ấy." },
  { id: 98, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["beautiful.", "are", "My stamps", "very"], correctAnswer: "My stamps are very beautiful.", explanation: "Những con tem của tôi rất đẹp." },
  { id: 99, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ many rulers are there? – There are two rulers.", correctAnswer: "How", explanation: "How many: Bao nhiêu." },
  { id: 100, type: QuestionType.FILL_IN_BLANK, questionText: "She tells her friend to come to her house at 7 o’clock on _ _ _ _ _ _ _ _ .", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636161992745323604_Audio.mp3"), correctAnswer: "Saturday", explanation: "Nghe audio: Thứ Bảy." },
  { id: 101, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["is", "the first", "month of", "January", "the year."], correctAnswer: "January is the first month of the year.", explanation: "Tháng Một là tháng đầu tiên trong năm." },
  { id: 102, type: QuestionType.MULTIPLE_CHOICE, questionText: "Mary … to school at 8.00 o’clock.", options: ["go", "goes", "to go", "go to"], correctAnswer: "goes", explanation: "Mary (số ít) -> Goes." },
  { id: 103, type: QuestionType.MULTIPLE_CHOICE, questionText: "Can you … English?", options: ["draw", "play", "speak", "walk"], correctAnswer: "speak", explanation: "Speak English: Nói tiếng Anh." },
  { id: 104, type: QuestionType.MULTIPLE_CHOICE, questionText: "... do you have Arts? – I have Arts on Monday.", options: ["What", "When", "Where", "How"], correctAnswer: "When", explanation: "When: Khi nào." },
  { id: 105, type: QuestionType.MULTIPLE_CHOICE, questionText: "... you like some water, Sam? – No, thanks.", options: ["Can", "Are", "Is", "Would"], correctAnswer: "Would", explanation: "Would you like: Bạn có muốn." },
  { id: 106, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["to borrow", "went to", "Jane", "some books.", "the library"], correctAnswer: "Jane went to the library to borrow some books.", explanation: "Jane đã đi đến thư viện để mượn sách." },
  { id: 107, type: QuestionType.FILL_IN_BLANK, questionText: "These pencils _ _ _ for you. - Many thanks.", correctAnswer: "are", explanation: "Pencils (số nhiều) -> Are." },
  { id: 108, type: QuestionType.MULTIPLE_CHOICE, questionText: "Why do you want to go shopping? – Because ... .", options: ["I’m bored", "I’m friendly", "I’m athletic", "I’m intelligent"], correctAnswer: "I’m bored", explanation: "I'm bored: Tôi chán (muốn đi mua sắm)." },
  { id: 109, type: QuestionType.MULTIPLE_CHOICE, questionText: "What ... do you go to school? - I go to school at six o’clock.", options: ["name", "time", "subjects", "many"], correctAnswer: "time", explanation: "What time: Mấy giờ." },
  { id: 110, type: QuestionType.FILL_IN_BLANK, questionText: "He has _ _ _ _ _ _ at 8:30.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206420875252012_Audio.mp3"), correctAnswer: "dinner", explanation: "Nghe audio: dinner: bữa tối." },
  { id: 111, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["I", "twice", "a week.", "have", "Music"], correctAnswer: "I have Music twice a week.", explanation: "Tôi có môn Nhạc 2 lần một tuần." },
  { id: 112, type: QuestionType.MULTIPLE_CHOICE, questionText: "Linh can sing _______ English songs.", options: ["a", "an", "many", "that"], correctAnswer: "many", explanation: "Songs (số nhiều) -> Many." },
  { id: 113, type: QuestionType.MULTIPLE_CHOICE, questionText: "What’s the ___ today? – It’s the third of December.", options: ["date", "year", "month", "day"], correctAnswer: "date", explanation: "What's the date: Ngày mấy." },
  { id: 114, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the word that the has underlined part pronounced differently from the others", options: ["Thanks", "Apple", "Happy", "Baby"], correctAnswer: "Baby", explanation: "'Baby' /ei/, còn lại /æ/." },
  { id: 115, type: QuestionType.MULTIPLE_CHOICE, questionText: "Let’s go to the … to see ’’Frozen’’.", options: ["cinema", "post office", "bookshop", "food stall"], correctAnswer: "cinema", explanation: "Cinema: Rạp chiếu phim." },
  { id: 116, type: QuestionType.FILL_IN_BLANK, questionText: "Our summer vacation is in December and J_ _ _ _ _ _ .", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi%20Th%E1%BB%AD/Thi_trai_nghiem_2021/Lop4/Nghe/E4_7.mp3"), correctAnswer: "anuary", explanation: "January: Tháng Một." },
  { id: 117, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Does she", "like", "music club?", "in the", "singing"], correctAnswer: "Does she like singing in the music club?", explanation: "Cô ấy có thích hát trong câu lạc bộ âm nhạc không?" },
  { id: 118, type: QuestionType.FILL_IN_BLANK, questionText: "Look a_ the board, please.", correctAnswer: "t", explanation: "Look at: Nhìn vào." },
  { id: 119, type: QuestionType.MULTIPLE_CHOICE, questionText: "A: What subjects do you have today? - B: I have Maths, Vietnamese and Music.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505748399666571_566X320.jpg"), options: ["Picture 1", "Picture 2", "Picture 3", "Picture 4"], correctAnswer: "Picture 1", explanation: "Chọn tranh phù hợp (mặc định Picture 1)." },
  { id: 120, type: QuestionType.MULTIPLE_CHOICE, questionText: "What did they do in the park?", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636161925109401480_Audio.mp3"), options: ["They walked the dog.", "They planted a tree.", "They flew kites.", "They went jogging."], correctAnswer: "They flew kites.", explanation: "Nghe audio." },
  { id: 121, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["My", "is good", "sister", "younger", "at singing."], correctAnswer: "My younger sister is good at singing.", explanation: "Em gái tôi hát rất hay." },
  { id: 122, type: QuestionType.FILL_IN_BLANK, questionText: "Children shouldn’t drink coffee. It is not good _ _ _ their health.", correctAnswer: "for", explanation: "Good for: Tốt cho." },
  { id: 123, type: QuestionType.FILL_IN_BLANK, questionText: "The cak_ is for you.", correctAnswer: "e", explanation: "Cake: Bánh." },
  { id: 124, type: QuestionType.FILL_IN_BLANK, questionText: "This is _ poster.", correctAnswer: "a", explanation: "A poster: Một tấm áp phích." },
  { id: 125, type: QuestionType.FILL_IN_BLANK, questionText: "Thursday is a scho_ _ day.", correctAnswer: "ol", explanation: "School day: Ngày đi học." },
  { id: 126, type: QuestionType.MULTIPLE_CHOICE, questionText: "What’s ... name? – He’s Tommy.", options: ["her", "his", "he", "she"], correctAnswer: "his", explanation: "He -> His name." },
  { id: 127, type: QuestionType.FILL_IN_BLANK, questionText: "The girl’s new toy is a _ _ _ _ _ board.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505724750582276_Audio.mp3"), correctAnswer: "skate", explanation: "Skateboard: Ván trượt." },
  { id: 128, type: QuestionType.MULTIPLE_CHOICE, questionText: "Is that a pencil? – No, ... .", options: ["it isn’t", "it is", "it does", "it doesn’t"], correctAnswer: "it isn’t", explanation: "No, it isn't." },
  { id: 129, type: QuestionType.FILL_IN_BLANK, questionText: "They are from L_ _ _ _ _ , England.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636162022686792118_566X320.jpg"), correctAnswer: "ondon", explanation: "London: Luân Đôn." },
  { id: 130, type: QuestionType.FILL_IN_BLANK, questionText: "Today is _ _ _ eleventh of October.", correctAnswer: "the", explanation: "The eleventh: Ngày 11." },
  { id: 131, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["America", "English", "Canada", "Vietnam"], correctAnswer: "English", explanation: "English là quốc tịch/ngôn ngữ, còn lại là tên nước." },
  { id: 132, type: QuestionType.MULTIPLE_CHOICE, questionText: "Why is Peter happy? - Because today is ... birthday.", options: ["he", "she", "his", "her"], correctAnswer: "his", explanation: "Peter -> His." },
  { id: 133, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the odd one out:", options: ["Monday", "April", "Sunday", "Thursday"], correctAnswer: "April", explanation: "April là tháng, còn lại là thứ." },
  { id: 134, type: QuestionType.FILL_IN_BLANK, questionText: "We made a purple bo_ t.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi%20Th%E1%BB%AD/Thi_trai_nghiem_2021/Lop4/Anh/anhthuyen.jpg"), correctAnswer: "a", explanation: "Boat: Con thuyền." },
  { id: 135, type: QuestionType.FILL_IN_BLANK, questionText: "My father is a taxi dri_ _ r.", correctAnswer: "ve", explanation: "Driver: Tài xế." },
  { id: 136, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ _ _ is David from? – He’s from England.", correctAnswer: "Where", explanation: "Where: Ở đâu." },
  { id: 137, type: QuestionType.FILL_IN_BLANK, questionText: "John is _ _ _ ng exercise in the school gym.", correctAnswer: "doi", explanation: "Doing exercise: Tập thể dục." },
  { id: 138, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["went out", "my friend", "I", "with", "after dinner."], correctAnswer: "I went out with my friend after dinner.", explanation: "Tôi đi chơi với bạn sau bữa tối." },
  { id: 139, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["me?", "give", "How many", "books", "do you"], correctAnswer: "How many books do you give me?", explanation: "Bạn cho tôi bao nhiêu quyển sách?" },
  { id: 140, type: QuestionType.MULTIPLE_CHOICE, questionText: "I have ... robot.", options: ["a", "an", "two", "and"], correctAnswer: "a", explanation: "A robot: Một con rô bốt." },
  { id: 141, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["my", "favourite", "English", "is", "subject."], correctAnswer: "English is my favourite subject.", explanation: "Tiếng Anh là môn học yêu thích của tôi." },
  { id: 142, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["A bird", "can", "fly", "but it", "cannot swim."], correctAnswer: "A bird can fly but it cannot swim.", explanation: "Một con chim có thể bay nhưng không thể bơi." },
  { id: 143, type: QuestionType.FILL_IN_BLANK, questionText: "Do_ _ Linh have English on Thursday?", correctAnswer: "es", explanation: "Does: Trợ động từ." },
  { id: 144, type: QuestionType.FILL_IN_BLANK, questionText: "A cat can _ _ _ _ _ a tree.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208420293969115_566X320.jpg"), correctAnswer: "climb", explanation: "Climb: Trèo." },
  { id: 145, type: QuestionType.FILL_IN_BLANK, questionText: "_ _ _ _ is your birthday? - It’s in July.", correctAnswer: "When", explanation: "When: Khi nào." },
  { id: 146, type: QuestionType.FILL_IN_BLANK, questionText: "What’s the d_ _ e today? It’s the first of November.", correctAnswer: "at", explanation: "Date: Ngày." },
  { id: 147, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Would", "ice cream?", "like", "you", "an"], correctAnswer: "Would you like an ice cream?", explanation: "Bạn có muốn ăn kem không?" },
  { id: 148, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["song?", "Can", "a", "sing", "you"], correctAnswer: "Can you sing a song?", explanation: "Bạn có thể hát một bài hát không?" },
  { id: 149, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["today?", "date", "the", "What", "is"], correctAnswer: "What is the date today?", explanation: "Hôm nay là ngày bao nhiêu?" },
  { id: 150, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["bicycles", "many", "are", "How", "there?"], correctAnswer: "How many bicycles are there?", explanation: "Có bao nhiêu cái xe đạp?" },
  { id: 151, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["There are", "day.", "twenty-four", "hours a"], correctAnswer: "There are twenty-four hours a day.", explanation: "Có 24 giờ một ngày." },
  { id: 152, type: QuestionType.MULTIPLE_CHOICE, questionText: "Which word has the underlined part pronounced differently from the letter ‘s’ in ’’its’’?", options: ["speak", "trees", "table tennis", "house"], correctAnswer: "trees", explanation: "'Trees' /z/, còn lại /s/." },
  { id: 153, type: QuestionType.MULTIPLE_CHOICE, questionText: "Where ... he from? – He’s from England.", options: ["is", "are", "and", "there"], correctAnswer: "is", explanation: "He -> Is." },
  { id: 154, type: QuestionType.FILL_IN_BLANK, questionText: "This is the way Mai go_ _ to school every day.", correctAnswer: "es", explanation: "Goes: Đi." },
  { id: 155, type: QuestionType.FILL_IN_BLANK, questionText: "I’m _ _ _ _ _ _ _ . I want some milk.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207251379505051_566X320.jpg"), correctAnswer: "thirsty", explanation: "Thirsty: Khát nước." },
  { id: 156, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Let’s", "go to the", "pool.", "swimming"], correctAnswer: "Let’s go to the swimming pool.", explanation: "Hãy đi đến hồ bơi." },
  { id: 157, type: QuestionType.MULTIPLE_CHOICE, questionText: "Listen and tick:", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206448657826675_Audio.mp3"), options: ["What can’t you do?", "What can he do?", "What can’t he do?", "What can you do?"], correctAnswer: "What can you do?", explanation: "Nghe audio." },
  { id: 158, type: QuestionType.MULTIPLE_CHOICE, questionText: "Hi, ... Alan.", options: ["I", "I’m", "You", "He"], correctAnswer: "I’m", explanation: "I'm Alan: Tôi là Alan." },
  { id: 159, type: QuestionType.FILL_IN_BLANK, questionText: "They like co_ _ _ _ _ ing stamps.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790911055605645_Audio.mp3"), correctAnswer: "llect", explanation: "Collecting: Sưu tầm." },
  { id: 160, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the best answer", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/D2_10.jpg"), options: ["A rabbit", "A lion", "A chicken", "A guinea pig"], correctAnswer: "A guinea pig", explanation: "Nhìn tranh: Chuột lang." },
  { id: 161, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Playing", "badminton", "is", "good."], correctAnswer: "Playing badminton is good.", explanation: "Chơi cầu lông rất tốt." },
  { id: 162, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["is bigger.", "but", "my house", "His house", "is nice"], correctAnswer: "His house is nice but my house is bigger.", explanation: "Nhà cậu ấy đẹp nhưng nhà tôi to hơn." },
  { id: 163, type: QuestionType.MULTIPLE_CHOICE, questionText: "They’re going ... school.", options: ["at", "on", "to", "in"], correctAnswer: "to", explanation: "Go to school: Đi học." },
  { id: 164, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Tomorrow", "October", "is", "twenty-fourth.", "the"], correctAnswer: "Tomorrow is October the twenty-fourth.", explanation: "Ngày mai là 24 tháng 10." },
  { id: 165, type: QuestionType.FILL_IN_BLANK, questionText: "Where _ _ your grandfather from?", correctAnswer: "is", explanation: "Grandfather (số ít) -> Is." },
  { id: 166, type: QuestionType.MULTIPLE_CHOICE, questionText: "What do you do ... Maths lessons?", options: ["from", "and", "during", "on"], correctAnswer: "during", explanation: "During: Trong suốt (tiết học)." },
  { id: 167, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["eighth of", "the", "July.", "on", "My birthday is"], correctAnswer: "My birthday is on the eighth of July.", explanation: "Sinh nhật tôi vào ngày 8 tháng 7." },
  { id: 168, type: QuestionType.MULTIPLE_CHOICE, questionText: "Why ... we come and visit Uncle Tom? - That’s a good idea.", options: ["don’t", "have", "do", "aren’t"], correctAnswer: "don’t", explanation: "Why don't we...: Tại sao chúng ta không..." },
  { id: 169, type: QuestionType.FILL_IN_BLANK, questionText: "B_ _ _ HING MY HAIR.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/nghe/D2_9.mp3"), correctAnswer: "RUS", explanation: "Brushing: Chải (tóc)." },
  { id: 170, type: QuestionType.MULTIPLE_CHOICE, questionText: "I ___ a new pupil in class 4A.", options: ["am", "are", "were", "is"], correctAnswer: "am", explanation: "I am: Tôi là." },
  { id: 171, type: QuestionType.MULTIPLE_CHOICE, questionText: "Can he ... with a yo-yo? – Yes, he can.", options: ["says", "plays", "say", "play"], correctAnswer: "play", explanation: "Can + V nguyên thể (Play)." },
  { id: 172, type: QuestionType.FILL_IN_BLANK, questionText: "It’s ra_ _ y today.", correctAnswer: "in", explanation: "Rainy: Có mưa." },
  { id: 173, type: QuestionType.FILL_IN_BLANK, questionText: "H_ _ ’s the weather in Hanoi?", correctAnswer: "ow", explanation: "How: Như thế nào." },
  { id: 174, type: QuestionType.FILL_IN_BLANK, questionText: "What is Mai doing in t_ _ classroom?", correctAnswer: "he", explanation: "The classroom: Phòng học." },
  { id: 175, type: QuestionType.FILL_IN_BLANK, questionText: "I pl_ _ badminton every Monday.", correctAnswer: "ay", explanation: "Play: Chơi." },
  { id: 176, type: QuestionType.FILL_IN_BLANK, questionText: "Their children are listening _ _ “The Wheels on the Bus”.", correctAnswer: "to", explanation: "Listen to: Nghe." },
  { id: 177, type: QuestionType.MULTIPLE_CHOICE, questionText: "I have two brothers. ... names are Minh and Tung.", options: ["His", "Their", "They", "Theirs"], correctAnswer: "Their", explanation: "Their names: Tên của họ." },
  { id: 178, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["market?", "often", "How", "to the", "do you go"], correctAnswer: "How often do you go to the market?", explanation: "Bạn có thường xuyên đi chợ không?" },
  { id: 179, type: QuestionType.FILL_IN_BLANK, questionText: "I’m learning to how to _ _ _ _ the piano.", correctAnswer: "play", explanation: "Play: Chơi (đàn)." },
  { id: 180, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["any", "My brother", "have", "pets.", "doesn't"], correctAnswer: "My brother doesn't have any pets.", explanation: "Anh tôi không có thú cưng nào." },
  { id: 181, type: QuestionType.MULTIPLE_CHOICE, questionText: "It’s not difficult ... a new dress.", options: ["make", "makes", "to make", "making"], correctAnswer: "to make", explanation: "It + be + adj + to V." },
  { id: 182, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["today.", "It is", "sunny", "Hanoi", "in"], correctAnswer: "It is sunny in Hanoi today.", explanation: "Hôm nay trời nắng ở Hà Nội." },
  { id: 183, type: QuestionType.MULTIPLE_CHOICE, questionText: "A: What’s the … tomorrow? - B: It’s the fifteenth of August.", options: ["day", "date", "week", "month"], correctAnswer: "date", explanation: "Date: Ngày tháng." },
  { id: 184, type: QuestionType.FILL_IN_BLANK, questionText: "August is the e_ _ _ _ _ month of the year.", correctAnswer: "ighth", explanation: "Eighth: Thứ 8." },
  { id: 185, type: QuestionType.MULTIPLE_CHOICE, questionText: "Is ... school big?", options: ["you", "your", "yous", "yours"], correctAnswer: "your", explanation: "Your school: Trường của bạn." },
  { id: 186, type: QuestionType.MULTIPLE_CHOICE, questionText: "A … works in hospital.", options: ["doctor", "worker", "farmer", "housewife"], correctAnswer: "doctor", explanation: "Doctor: Bác sĩ." },
  { id: 187, type: QuestionType.MULTIPLE_CHOICE, questionText: "How many stickers does the boy have?", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/nghe/D4_16.mp3"), options: ["16", "60", "14", "40"], correctAnswer: "60", explanation: "Nghe audio: sixty (60)." },
  { id: 188, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["house.", "is", "my", "This"], correctAnswer: "This is my house.", explanation: "Đây là nhà tôi." },
  { id: 189, type: QuestionType.MULTIPLE_CHOICE, questionText: "I’m from England. I can speak ... .", options: ["Vietnam", "France", "English", "America"], correctAnswer: "English", explanation: "Speak English: Nói tiếng Anh." },
  { id: 190, type: QuestionType.FILL_IN_BLANK, questionText: "W_ _ t a nice present!", correctAnswer: "ha", explanation: "What a...: Câu cảm thán." },
  { id: 191, type: QuestionType.FILL_IN_BLANK, questionText: "Linh can’t r_ _ _ a bike. She goes to school on foot.", correctAnswer: "ide", explanation: "Ride a bike: Đi xe đạp." },
  { id: 192, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["to the", "Let’s go", "at school.", "Super Music Club"], correctAnswer: "Let’s go to the Super Music Club at school.", explanation: "Hãy đi đến CLB Âm nhạc ở trường." },
  { id: 193, type: QuestionType.FILL_IN_BLANK, questionText: "Are those boys Chin_ _ _ ?", correctAnswer: "ese", explanation: "Chinese: Người Trung Quốc." },
  { id: 194, type: QuestionType.FILL_IN_BLANK, questionText: "L_ _ k at the picture.", correctAnswer: "oo", explanation: "Look at: Nhìn." },
  { id: 195, type: QuestionType.MULTIPLE_CHOICE, questionText: "Choose the word that has underlined part pronounced differently from the others.", options: ["Book", "Good", "Afternoon", "Football"], correctAnswer: "Afternoon", explanation: "'Afternoon' /u:/, còn lại /u/." },
  { id: 196, type: QuestionType.REARRANGE, questionText: "Sắp xếp câu:", rearrangeParts: ["Sundays.", "go out", "on", "I", "for dinner"], correctAnswer: "I go out for dinner on Sundays.", explanation: "Tôi đi ăn tối ở ngoài vào các ngày Chủ Nhật." },
  { id: 197, type: QuestionType.MULTIPLE_CHOICE, questionText: "Is … a holiday? – No, it isn’t.", options: ["Birthday", "Christmas Day", "New Year", "Mid-Autumn"], correctAnswer: "Birthday", explanation: "Birthday (sinh nhật) là ngày kỷ niệm cá nhân, không phải kỳ nghỉ lễ (holiday) chung." },
  { id: 198, type: QuestionType.FILL_IN_BLANK, questionText: "Give me a gl_ _ _ of milk, please.", imageUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207451055951753_566X320.jpg"), correctAnswer: "ass", explanation: "Glass: Cái cốc." },
  { id: 199, type: QuestionType.FILL_IN_BLANK, questionText: "What nationality is Carla? - She’s _ _ _ _ ish.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505778598688459_Audio.mp3"), correctAnswer: "Span", explanation: "Spanish: Người Tây Ban Nha." },
  { id: 200, type: QuestionType.FILL_IN_BLANK, questionText: "I have _ _ _ books.", audioUrl: cleanUrl("https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790677578900928_Audio.mp3"), correctAnswer: "six", explanation: "Nghe audio: six (6)." }
];

        // --- 3. COMPONENTS ---
        const Button = ({ children, variant = 'primary', size = 'md', className = '', ...props }) => {
             const baseStyles = "inline-flex items-center justify-center font-bold transition-all duration-200 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm transform active:scale-95";
             const variants = {
                primary: "bg-blue-600 hover:bg-blue-700 text-white shadow-blue-500/30 focus:ring-blue-500",
                secondary: "bg-emerald-500 hover:bg-emerald-600 text-white shadow-emerald-500/30 focus:ring-emerald-500",
                danger: "bg-rose-500 hover:bg-rose-600 text-white shadow-rose-500/30 focus:ring-rose-500",
                outline: "bg-white border-2 border-slate-300 text-slate-600 hover:border-blue-500 hover:text-blue-600"
             };
             const sizes = { sm: "px-4 py-1.5 text-sm", md: "px-6 py-3 text-base", lg: "px-8 py-4 text-lg" };
             return <button className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`} {...props}>{children}</button>;
        };

        const StartScreen = ({ onStart }) => {
            const [name, setName] = useState('');
            const handleSubmit = (e) => { e.preventDefault(); if (name.trim()) onStart(name.trim()); };
            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-cyan-500 to-blue-600 p-4">
                    <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center animate-slide-up">
                        <div className="mb-8">
                            <h1 className="text-3xl font-extrabold text-slate-800 mb-2">IOE K4 ĐỀ SỐ 04</h1>
                            <p className="text-slate-500">Luyện thi tiếng Anh IOE cùng AI Master</p>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="text-left"><label className="block text-sm font-medium text-slate-700 mb-2">Tên của bạn</label><input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder="Nhập tên..." className="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all" required /></div>
                            <Button type="submit" className="w-full" size="lg" disabled={!name.trim()}>Bắt đầu chơi</Button>
                        </form>
                    </div>
                </div>
            );
        };

        const AudioPlayer = ({ src }) => {
            const audioRef = useRef(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const togglePlay = () => { if (audioRef.current) { if (isPlaying) audioRef.current.pause(); else audioRef.current.play(); setIsPlaying(!isPlaying); } };
            return (
                <div className="flex items-center gap-3 bg-slate-100 p-3 rounded-lg border border-slate-200">
                    <button type="button" onClick={togglePlay} className="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors">{isPlaying ? '❚❚' : '▶'}</button>
                    <span className="text-sm font-semibold text-slate-600 uppercase tracking-wide">Nghe câu hỏi</span>
                    <audio ref={audioRef} src={src} onEnded={() => setIsPlaying(false)} className="hidden" />
                </div>
            );
        };

        const QuestionCard = ({ question, onAnswer, isAnswered, userAnswer }) => {
            const [inputVal, setInputVal] = useState('');
            const [selectedParts, setSelectedParts] = useState([]);
            const [showHint, setShowHint] = useState(false);
            const [hintText, setHintText] = useState('');

            useEffect(() => { 
                setInputVal(''); 
                setSelectedParts([]); 
                setShowHint(false);
                setHintText('');
            }, [question.id]);

            const normalize = (str) => str ? str.replace(/[.,!?;:'"]/g, '').replace(/\s+/g, ' ').trim().toLowerCase() : "";
            const isCorrect = () => userAnswer && normalize(userAnswer) === normalize(question.correctAnswer);

            const handleMCSelect = (opt) => !isAnswered && onAnswer(opt);
            const handleInputSubmit = (e) => { e.preventDefault(); if (!isAnswered && inputVal.trim()) onAnswer(inputVal.trim()); };
            const handlePartClick = (part) => { if (!isAnswered) setSelectedParts(prev => prev.includes(part) ? prev.filter(p => p !== part) : [...prev, part]); };
            const handleRearrangeSubmit = () => !isAnswered && selectedParts.length > 0 && onAnswer(selectedParts.join(' '));

            const generateHint = () => {
                if (hintText) return;
                let text = '';
                if (question.type === QuestionType.MULTIPLE_CHOICE) {
                    const wrongOptions = question.options?.filter(opt => opt !== question.correctAnswer) || [];
                    if (wrongOptions.length > 0) {
                         const randomWrong = wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
                         text = `Gợi ý 50/50: Loại bỏ đáp án "${randomWrong}".`;
                    }
                } else if (question.type === QuestionType.FILL_IN_BLANK) {
                     const answer = question.correctAnswer.trim();
                     text = `Từ này có ${answer.length} chữ cái. Bắt đầu bằng "${answer.charAt(0).toUpperCase()}...".`;
                } else {
                     const words = question.correctAnswer.split(' ');
                     const hintPhrase = words.slice(0, Math.max(1, Math.floor(words.length/2))).join(' ');
                     text = `Gợi ý: Câu bắt đầu bằng "${hintPhrase}..."`;
                }
                setHintText(text);
            };

            return (
                <div className="w-full max-w-3xl mx-auto mb-8 animate-fade-in">
                    <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100">
                        <div className="bg-slate-50 px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-extrabold uppercase">{question.type.replace(/_/g, ' ')}</span>
                                {!isAnswered && (
                                    <button onClick={() => { generateHint(); setShowHint(!showHint); }} className="px-3 py-1 text-xs font-bold border rounded-full bg-yellow-50 text-yellow-600 border-yellow-200 hover:bg-yellow-100">
                                        {showHint ? 'Ẩn Gợi ý' : 'Gợi ý'}
                                    </button>
                                )}
                            </div>
                            <span className="text-xs font-bold text-slate-300">ID: {question.id}</span>
                        </div>
                        <div className="p-6 sm:p-10">
                            <div className="mb-6 space-y-4">
                                {question.imageUrl && <div className="flex justify-center"><img src={question.imageUrl} className="max-h-72 rounded-lg shadow-md" onError={(e) => e.target.style.display = 'none'} /></div>}
                                {question.audioUrl && <div className="bg-blue-50 p-4 rounded-xl"><AudioPlayer src={question.audioUrl} /></div>}
                            </div>

                            {showHint && !isAnswered && (
                                <div className="mb-6 bg-yellow-50 p-3 rounded-lg text-sm text-yellow-800 border border-yellow-200">
                                    <strong>Gợi ý:</strong> {hintText}
                                </div>
                            )}

                            <h2 className="text-xl sm:text-2xl font-bold text-slate-800 mb-6">{question.questionText}</h2>
                            
                            {question.type === QuestionType.MULTIPLE_CHOICE && (
                                <div className="grid grid-cols-1 gap-3">
                                    {question.options?.map((opt, idx) => (
                                        <button key={idx} onClick={() => handleMCSelect(opt)} disabled={isAnswered} className={`w-full p-4 rounded-xl text-left border-2 transition-all ${isAnswered ? (opt === question.correctAnswer ? 'bg-green-100 border-green-500 text-green-900' : opt === userAnswer ? 'bg-red-100 border-red-500 text-red-900' : 'bg-slate-50 opacity-60') : 'bg-white hover:border-blue-400 hover:shadow-md'}`}>
                                            <span className="font-bold mr-4 w-6 inline-block">{String.fromCharCode(65 + idx)}</span>{opt}
                                        </button>
                                    ))}
                                </div>
                            )}

                            {question.type === QuestionType.FILL_IN_BLANK && (
                                <form onSubmit={handleInputSubmit} className="flex flex-col gap-2">
                                    <div className="flex gap-3">
                                        <input type="text" value={isAnswered ? userAnswer : inputVal} onChange={(e) => setInputVal(e.target.value)} disabled={isAnswered} className={`flex-1 p-4 rounded-xl border-2 text-lg outline-none ${isAnswered ? (isCorrect() ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-slate-200 focus:border-blue-500'}`} placeholder="Nhập đáp án..." />
                                        {!isAnswered && <Button type="submit">Trả lời</Button>}
                                    </div>
                                    {!isAnswered && <div className="text-xs text-slate-400 text-right">Đã nhập: {inputVal.length} ký tự</div>}
                                </form>
                            )}

                            {question.type === QuestionType.REARRANGE && (
                                <div className="space-y-6">
                                    <div className="flex flex-wrap gap-3 p-4 bg-slate-50 rounded-xl border shadow-inner min-h-[60px]">
                                        {question.rearrangeParts?.map((part, idx) => (
                                            <button key={idx} onClick={() => handlePartClick(part)} disabled={isAnswered || selectedParts.includes(part)} className={`px-4 py-2 rounded-lg bg-white border shadow-sm transition-all active:scale-95 ${selectedParts.includes(part) ? 'opacity-0 pointer-events-none' : 'hover:border-blue-400'}`}>{part}</button>
                                        ))}
                                    </div>
                                    <div className={`min-h-[80px] p-4 rounded-xl border-2 border-dashed flex flex-wrap gap-2 items-center ${isAnswered ? (isCorrect() ? 'border-green-500 bg-green-50/50' : 'border-red-500 bg-red-50/50') : 'border-slate-300 bg-white'}`}>
                                         {selectedParts.length === 0 && !isAnswered && <div className="w-full text-center text-slate-400 italic">Bấm từ để sắp xếp...</div>}
                                        {selectedParts.map((part, idx) => <button key={idx} onClick={() => handlePartClick(part)} disabled={isAnswered} className="bg-blue-100 text-blue-900 px-3 py-1.5 rounded-lg border border-blue-200 font-medium shadow-sm hover:bg-red-100 hover:text-red-800 transition-colors">{part}</button>)}
                                    </div>
                                    {!isAnswered && <div className="flex justify-end"><Button onClick={handleRearrangeSubmit} disabled={selectedParts.length === 0}>Xác nhận</Button></div>}
                                </div>
                            )}

                            {isAnswered && (
                                <div className={`mt-8 p-6 rounded-xl border-l-4 shadow-sm animate-fade-in ${isCorrect() ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'}`}>
                                    <div className="flex items-start gap-4">
                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center shrink-0 text-white font-bold ${isCorrect() ? 'bg-green-500' : 'bg-red-500'}`}>{isCorrect() ? '✓' : '✕'}</div>
                                        <div>
                                            <h3 className={`font-bold text-xl mb-2 ${isCorrect() ? 'text-green-800' : 'text-red-800'}`}>{isCorrect() ? 'Chính xác!' : 'Chưa chính xác'}</h3>
                                            {!isCorrect() && <div className="mb-2"><span className="text-red-600 font-bold text-sm uppercase">Đáp án đúng:</span> <span className="font-bold text-slate-800">{question.correctAnswer}</span></div>}
                                            <div className="bg-white/60 p-3 rounded-lg text-slate-700 text-sm"><span className="font-bold text-blue-600 block mb-1">Giải thích:</span>{question.explanation}</div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const QuestionGrid = ({ questions, userAnswers, currentIndex, onJump, onClose }) => {
            const getStatusColor = (q, idx) => {
                const ans = userAnswers.find(a => a.questionId === q.id);
                if (idx === currentIndex) return "ring-2 ring-blue-500 border-blue-500 text-blue-600 bg-white";
                if (!ans) return "bg-slate-100 text-slate-400 border-transparent";
                return ans.isCorrect ? "bg-green-500 text-white border-green-600" : "bg-red-500 text-white border-red-600";
            };
            return (
                <div className="fixed inset-0 z-50 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden animate-slide-up">
                        <div className="p-6 border-b flex justify-between items-center bg-slate-50">
                            <div><h2 className="text-xl font-bold">Danh sách câu hỏi</h2><p className="text-sm text-slate-500">Đã làm: {userAnswers.length} / {questions.length}</p></div>
                            <button onClick={onClose} className="p-2 hover:bg-slate-200 rounded-full">✕</button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 custom-scrollbar"><div className="grid grid-cols-5 sm:grid-cols-10 gap-3">{questions.map((q, idx) => (<button key={q.id} onClick={() => { onJump(idx); onClose(); }} className={`h-10 w-10 rounded-lg font-bold border transition-all ${getStatusColor(q, idx)}`}>{idx + 1}</button>))}</div></div>
                        <div className="p-4 bg-slate-50 border-t text-xs text-slate-500 flex gap-4 justify-center flex-wrap"><div className="flex items-center gap-2"><span className="w-3 h-3 bg-green-500 rounded-full"></span> Đúng</div><div className="flex items-center gap-2"><span className="w-3 h-3 bg-red-500 rounded-full"></span> Sai</div><div className="flex items-center gap-2"><span className="w-3 h-3 ring-2 ring-blue-500 rounded-full"></span> Đang làm</div><div className="flex items-center gap-2"><span className="w-3 h-3 bg-slate-200 rounded-full"></span> Chưa làm</div></div>
                    </div>
                </div>
            );
        }

        const ResultScreen = ({ userName, userAnswers, onRetryAll, onRetryWrong }) => {
            const correct = userAnswers.filter(a => a.isCorrect).length;
            const total = userAnswers.length;
            const percent = total > 0 ? Math.round((correct/total)*100) : 0;
            const hasWrong = correct < total;
            const score = correct * 10;

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 animate-fade-in bg-slate-50">
                    <div className="bg-white rounded-3xl shadow-xl p-8 max-w-2xl w-full text-center">
                        <div className="mb-6 relative inline-block">
                            <svg className="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                                <circle cx="60" cy="60" r="54" fill="none" stroke="#e2e8f0" strokeWidth="12" />
                                <circle cx="60" cy="60" r="54" fill="none" stroke={percent >= 80 ? '#10b981' : percent >= 50 ? '#3b82f6' : '#ef4444'} strokeWidth="12" strokeDasharray="339.292" strokeDashoffset={339.292 - (339.292 * percent) / 100} className="transition-all duration-1000 ease-out" />
                            </svg>
                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-3xl font-bold text-slate-800">{percent}%</div>
                        </div>
                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Hoàn thành bài thi!</h2>
                        <p className="text-slate-600 mb-4">Chúc mừng <b>{userName}</b></p>
                        
                        <div className="mb-8 inline-flex items-baseline gap-2 bg-blue-50 px-6 py-2 rounded-2xl border border-blue-100">
                             <span className="text-4xl font-extrabold text-blue-600">{score}</span>
                             <span className="text-lg text-slate-500 font-bold">điểm</span>
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-8 bg-slate-50 p-4 rounded-xl">
                            <div><div className="text-2xl font-bold text-green-600">{correct}</div><div className="text-xs uppercase text-slate-500 font-bold">Đúng</div></div>
                            <div className="border-l border-slate-200"><div className="text-2xl font-bold text-red-500">{total - correct}</div><div className="text-xs uppercase text-slate-500 font-bold">Sai</div></div>
                        </div>
                        {hasWrong && (
                            <div className="text-left mb-6 max-h-48 overflow-y-auto custom-scrollbar border-t border-b py-4">
                                <h3 className="text-xs font-bold text-slate-400 uppercase mb-2">Cần xem lại</h3>
                                <div className="space-y-2">
                                    {userAnswers.filter(a => !a.isCorrect).map((ans, i) => {
                                        const q = QUIZ_DATA.find(x => x.id === ans.questionId);
                                        return q ? <div key={i} className="text-sm p-2 bg-red-50 rounded"><span className="font-bold text-red-500 mr-2">#{q.id}</span> {q.questionText} <br/><span className="text-xs text-slate-500">Đáp án: {q.correctAnswer}</span></div> : null;
                                    })}
                                </div>
                            </div>
                        )}
                        <div className="flex gap-4 justify-center">
                            <Button onClick={onRetryAll}>Chơi lại từ đầu</Button>
                            {hasWrong && <Button onClick={onRetryWrong} variant="danger">Làm lại câu sai</Button>}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [gameState, setGameState] = useState(GameState.START);
            const [userName, setUserName] = useState('');
            const [activeQuestions, setActiveQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [userAnswers, setUserAnswers] = useState([]);
            const [showGrid, setShowGrid] = useState(false);

            const handleStart = (name) => { setUserName(name); startSession(QUIZ_DATA); };
            const startSession = (questions) => { setActiveQuestions(questions); setCurrentIndex(0); setUserAnswers([]); setGameState(GameState.PLAYING); };
            
            const handleAnswer = (response) => {
                const q = activeQuestions[currentIndex];
                const normalize = (s) => s.replace(/[.,!?;:'"]/g, '').replace(/\s+/g, ' ').trim().toLowerCase();
                const isCorrect = normalize(response) === normalize(q.correctAnswer);
                setUserAnswers(prev => [...prev.filter(a => a.questionId !== q.id), { questionId: q.id, userResponse: response, isCorrect }]);
            };

            const handleNext = () => currentIndex < activeQuestions.length - 1 && setCurrentIndex(prev => prev + 1);
            const handlePrev = () => currentIndex > 0 && setCurrentIndex(prev => prev - 1);
            const handleSkip = () => handleNext();
            const handleFinish = () => setGameState(GameState.FINISHED);
            
            const handleRetryWrong = () => {
                const wrongIds = userAnswers.filter(a => !a.isCorrect).map(a => a.questionId);
                startSession(QUIZ_DATA.filter(q => wrongIds.includes(q.id)));
            };

            if (gameState === GameState.START) return <StartScreen onStart={handleStart} />;
            if (gameState === GameState.FINISHED) return <ResultScreen userName={userName} userAnswers={userAnswers} onRetryAll={() => startSession(QUIZ_DATA)} onRetryWrong={handleRetryWrong} />;

            const currentQ = activeQuestions[currentIndex];
            const answer = userAnswers.find(a => a.questionId === currentQ.id);
            const isAnswered = !!answer;
            const isLast = currentIndex === activeQuestions.length - 1;
            const allAnswered = userAnswers.length === activeQuestions.length;
            
            // Calculate Score
            const currentScore = userAnswers.filter(a => a.isCorrect).length * 10;

            return (
                <div className="min-h-screen bg-slate-100 flex flex-col items-center py-8 px-4 pb-32 relative">
                    <div className="w-full max-w-3xl flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm">
                        <div className="flex flex-col"><span className="text-xs font-bold text-slate-400 uppercase">Người chơi</span><span className="font-bold text-slate-700">{userName}</span></div>
                        
                        <div className="flex flex-col items-center px-4 border-l border-r border-slate-100">
                            <span className="text-xs font-bold text-slate-400 uppercase">Điểm số</span>
                            <span className="font-bold text-emerald-600 text-xl">{currentScore}</span>
                        </div>

                        <button onClick={() => setShowGrid(true)} className="flex items-center gap-2 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 rounded-lg text-sm font-bold text-slate-600">Danh sách</button>
                        <div className="flex flex-col items-end"><span className="text-xs font-bold text-slate-400 uppercase">Tiến độ</span><span className="font-bold text-blue-600 text-xl">{currentIndex + 1} <span className="text-slate-400 text-sm">/ {activeQuestions.length}</span></span></div>
                    </div>
                    <div className="w-full max-w-3xl bg-slate-200 rounded-full h-2 mb-8 overflow-hidden"><div className="bg-blue-600 h-full transition-all duration-300 ease-out" style={{ width: `${(userAnswers.length / activeQuestions.length) * 100}%` }}></div></div>
                    
                    <QuestionCard question={currentQ} onAnswer={handleAnswer} isAnswered={isAnswered} userAnswer={answer?.userResponse} />
                    
                    <div className="fixed bottom-0 left-0 right-0 p-4 bg-white border-t shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-10">
                        <div className="w-full max-w-3xl mx-auto flex justify-between items-center gap-4">
                            <Button onClick={handlePrev} variant="outline" disabled={currentIndex === 0} className="w-24">← Trước</Button>
                            <div className="flex-1 flex justify-center gap-3">
                                {isAnswered ? (
                                    <>
                                        {!isLast && <Button onClick={handleNext} size="md" className="shadow-xl shadow-blue-500/20 animate-bounce-short">Câu tiếp theo →</Button>}
                                        <Button onClick={handleFinish} variant={allAnswered ? "secondary" : "danger"}>Nộp bài</Button>
                                    </>
                                ) : <Button onClick={handleSkip} variant="outline" className="text-slate-400 hover:text-slate-600">Bỏ qua</Button>}
                            </div>
                            <Button onClick={handleNext} variant="outline" disabled={isLast} className={`w-24 ${isAnswered ? 'opacity-0 pointer-events-none hidden sm:flex' : ''}`}>Sau →</Button>
                        </div>
                    </div>
                    {showGrid && <QuestionGrid questions={activeQuestions} userAnswers={userAnswers} currentIndex={currentIndex} onJump={setCurrentIndex} onClose={() => setShowGrid(false)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
